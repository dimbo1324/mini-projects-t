### Проект: Реализация Асинхронного Пайплайна Обработки Данных в Go

В рамках этого проекта предлагается разработать систему асинхронной обработки данных, аналогичную конвейеру Unix, где выход одной программы служит входом для следующей. В нашем случае роль соединителей выполняют каналы Go, передающие данные между функциями-воркерами. Это позволяет создать эффективный поток обработки, минимизируя задержки и оптимизируя использование ресурсов.

Проект состоит из двух основных компонентов:
- Разработка функции `RunPipeline`, которая организует последовательную цепочку обработки данных через каналы.
- Реализация набора функций-воркеров для анализа пользовательских email и связанных сообщений.

Целевая цепочка обработки выглядит следующим образом:
```
emails.txt → SelectUsers → SelectMessages → CheckSpam → CombineResults
```
На вход поступают email-адреса пользователей. Система извлекает уникальных пользователей из базы, получает список их сообщений, проверяет каждое сообщение на спам и формирует итоговый отчет о статусе спама для каждого сообщения.

#### Детальное Описание Компонентов

1. **SelectUsers()**
   - **Вход**: Строка (email пользователя) внутри `interface{}`.
   - **Выход**: Структура `User{}` (результат вызова `GetUser()`).
   - **Особенности**:
     - Функция `GetUser()` выполняется за ~1 секунду. Поддерживается параллельное выполнение для нескольких пользователей, что позволяет сократить общее время обработки.
     - Некоторые email являются алиасами (псевдонимами) одного и того же пользователя (например, "batman@mail.ru" — алиас для "bruce.wayne@mail.ru"). Выход должен содержать только уникальных пользователей.

2. **SelectMessages()**
   - **Вход**: Структура `User{}` внутри `interface{}` (из `SelectUsers()`).
   - **Выход**: `MsgID` (идентификаторы сообщений, результат вызова `GetMessages()`).
   - **Особенности**:
     - Функция `GetMessages()` выполняется за ~1 секунду. Поддерживается параллельное выполнение.
     - Поддерживается батчинг: за один вызов можно передать до 2 пользователей. Для 10 пользователей это означает минимум 5 вызовов. Оптимальность количества вызовов проверяется в тестах.

3. **CheckSpam()**
   - **Вход**: `MsgID` внутри `interface{}` (идентификаторы сообщений).
   - **Выход**: Структура `MsgData{}` (содержит ID сообщения и флаг наличия спама, результат вызова `HasSpam()`).
   - **Особенности**:
     - Функция `HasSpam()` имитирует запрос к сервису антиспама и занимает ~100 мс на вызов. Существует ограничение на параллелизм: не более 5 одновременных запросов, иначе возвращается ошибка.

4. **CombineResults()**
   - **Вход**: `MsgData{}` внутри `interface{}`.
   - **Выход**: Строка в формате "<has_spam> <msg_id>" (например, "true 17696166526272393238").
   - **Особенности**:
     - Функция аккумулирует все входные данные, сортирует их сначала по наличию спама (true перед false), затем по ID сообщения. Пример вывода:
       ```
       true 123
       true 5555
       true 5556
       false 140
       false 3000
       false 3005
       ```

#### Ключевые Вызовы и Требования
- Баланс асинхронности: Полностью последовательная обработка может превысить лимит времени (3 секунды на весь процесс). Чрезмерный параллелизм может привести к ошибкам из-за ограничений сервисов (например, антибрут в `HasSpam()`).
- Оптимизация: Неэффективный батчинг в `SelectMessages()` увеличит количество вызовов и время выполнения.
- Общее время выполнения: Не более 3 секунд.
- Реализация: Код размещается в файле `spammer.go`.
- Зависимости: Установить с помощью `go get github.com/stretchr/testify/assert`.
- Запуск: `go run .`.
- Тестирование: `go test -v -race`.

#### Пример Журнала Выполнения (для теста `TestTotal`)
```
2023/01/01 11:26:21 [GetUser() 1.000449332s] args:tomasangelo@mail.ru res:{6935840902946149476 tomasangelo@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000461251s] args:bruce.wayne@mail.ru res:{12499983457589032104 bruce.wayne@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000632207s] args:harry.dubois@mail.ru res:{2436524555453976083 harry.dubois@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000856246s] args:k.kitsuragi@mail.ru res:{6411680653583780021 k.kitsuragi@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000894362s] args:d.vader@mail.ru res:{15459287427396367812 d.vader@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000934361s] args:red_prince@mail.ru res:{1193889969480132348 red_prince@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000910476s] args:peter.parker@mail.ru res:{13707254613635009050 peter.parker@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.000992091s] args:e.musk@mail.ru res:{14529939612954000739 e.musk@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.001022818s] args:noname@mail.ru res:{14126455436348693091 noname@mail.ru}
2023/01/01 11:26:21 [GetUser() 1.001016139s] args:bruce.wayne@mail.ru res:{12499983457589032104 bruce.wayne@mail.ru}
2023/01/01 11:26:22 [GetMessages() 1.000166253s] args:[{ID:14126455436348693091 Email:noname@mail.ru}] res:[6652443725402098015 221945221381252775 9656111811170476016 221962074543525747] err:<nil>
2023/01/01 11:26:22 [GetMessages() 1.00059829s] args:[{ID:2436524555453976083 Email:harry.dubois@mail.ru} {ID:6411680653583780021 Email:k.kitsuragi@mail.ru}] res:[12728377754914798838 14498495926778052146 12975933273041759035 12386730660396758454 9323185346293974544 8065084208075053255 10523043777071802347 12792092352287413255 12556782602004681106 12026159364158506481] err:<nil>
2023/01/01 11:26:22 [GetMessages() 1.000343439s] args:[{ID:15459287427396367812 Email:d.vader@mail.ru} {ID:1193889969480132348 Email:red_prince@mail.ru}] res:[7594744397141820297 1877225754447839300] err:<nil>
2023/01/01 11:26:22 [GetMessages() 1.000365591s] args:[{ID:13707254613635009050 Email:peter.parker@mail.ru} {ID:14529939612954000739 Email:e.musk@mail.ru}] res:[2803967521226628027 13245035231559086127 10493933060383355848 378045830174189628 10462184946173556768 10167774218733491071 11204847394727393252 10463884548348336960 15784986543485231004 16476037061321929257 17259218828069106373 4652873815360231330 357347175551886490 11512743696420569029 1595319133252549342 17696166526272393238] err:<nil>
2023/01/01 11:26:22 [GetMessages() 1.000755755s] args:[{ID:6935840902946149476 Email:tomasangelo@mail.ru} {ID:12499983457589032104 Email:bruce.wayne@mail.ru}] res:[5108368734614700369 16728486308265447483 7829088386935944034 26236336874602209 15161554273155698590 14107154567229229487 15728889559763622673 15262116397886015961 59892029605752939 17087986564527251681] err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.728826ms] args:14498495926778052146 res:false err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.808515ms] args:12386730660396758454 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.727841ms] args:12728377754914798838 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.864612ms] args:12975933273041759035 res:false err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.793487ms] args:6652443725402098015 res:false err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.478291ms] args:221945221381252775 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.613594ms] args:2803967521226628027 res:false err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.809267ms] args:9323185346293974544 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.646974ms] args:5108368734614700369 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 101.083156ms] args:7594744397141820297 res:false err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.900365ms] args:9656111811170476016 res:false err:<nil>
2023/01/01 11:26:22 [HasSpam() 100.846218ms] args:16728486308265447483 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 101.563802ms] args:8065084208075053255 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 101.528313ms] args:13245035231559086127 res:true err:<nil>
2023/01/01 11:26:22 [HasSpam() 101.388859ms] args:1877225754447839300 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.415444ms] args:7829088386935944034 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.775029ms] args:10493933060383355848 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.571509ms] args:12792092352287413255 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.631663ms] args:221962074543525747 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.960382ms] args:10523043777071802347 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.102036ms] args:10462184946173556768 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.165203ms] args:15161554273155698590 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.306838ms] args:12556782602004681106 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.394269ms] args:26236336874602209 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.545377ms] args:378045830174189628 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.12091ms] args:11204847394727393252 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.022293ms] args:15728889559763622673 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.511417ms] args:12026159364158506481 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.34448ms] args:14107154567229229487 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.479134ms] args:10167774218733491071 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.458353ms] args:16476037061321929257 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.550921ms] args:59892029605752939 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.674563ms] args:15262116397886015961 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.737998ms] args:10463884548348336960 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.700208ms] args:15784986543485231004 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.22859ms] args:11512743696420569029 res:false err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.34849ms] args:17087986564527251681 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.455444ms] args:4652873815360231330 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.603069ms] args:17259218828069106373 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 101.523291ms] args:357347175551886490 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.361413ms] args:1595319133252549342 res:true err:<nil>
2023/01/01 11:26:23 [HasSpam() 100.437573ms] args:17696166526272393238 res:true err:<nil>
```

#### Рекомендации по Реализации
- Учитывайте недетерминированный порядок выполнения горутин.
- Фокус на примерах из стандартной документации Go; внешние ресурсы не требуются.
- Избегайте накопления данных в промежуточных функциях (за исключением `CombineResults()`).
- Обеспечьте правильное завершение пайплайна: подумайте о закрытии каналов при исчерпании данных.
- При обнаружении race conditions (через `-race`) анализируйте вывод: строки кода, операции чтения/записи.
- Начните с последовательной версии для верификации результатов, затем оптимизируйте параллелизм.
- В `RunPipeline` учтите механизм завершения итерации по каналам.
- Визуализируйте поток данных в схеме для лучшего понимания.
- Используйте только предоставленные API-функции; прямые вычисления данных недопустимы.
- Избегайте `select` и `time.Sleep()`.
- Эталонная реализация занимает около 185 строк кода.